<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dark Hack Bangladesh</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #0d1117;
      font-family: 'Courier New', monospace;
      color: #fff;
      padding: 2rem;
    }
    .windows-box {
      background-color: #1e293b;
      padding: 1rem;
      margin-top: 2rem;
      border-radius: 0.75rem;
      box-shadow: 0 0 10px #3b82f6;
      max-height: 300px;
      overflow-y: auto;
    }
    .windows-entry {
      padding: 0.5rem;
      border-bottom: 1px solid #334155;
      font-size: 0.95rem;
    }
    .win { color: #22c55e; }
    .loss { color: #ef4444; }
    .highlight { font-weight: bold; }
  </style>
</head>
<body>
  <header class="text-center mb-6">
    <h1 class="text-4xl font-extrabold text-blue-500">Dark Hack</h1>
  </header>  <div class="text-center text-2xl font-bold text-yellow-400 mb-4">
    <div id="timer">00:30</div>
  </div>  <div id="infoBox" class="bg-blue-900 border-2 border-blue-500 rounded-xl p-6 w-full max-w-md mx-auto shadow-lg font-bold text-lg leading-8 mb-4">
    Big/Small: <span id="bigSmall" class="text-red-500">--</span> <span id="bsPercent">(0%)</span><br />
    Red/Green: <span id="redGreen" class="text-red-500">--</span><br />
    Number: <span id="numbersBox"></span><br />
  </div>  <div id="gameDataContainer" class="max-w-md mx-auto mb-6"></div>
  <div id="windowsBox" class="windows-box max-w-md mx-auto"></div>  <script>
    const bigSmallEl = document.getElementById('bigSmall');
    const redGreenEl = document.getElementById('redGreen');
    const numbersBox = document.getElementById('numbersBox');
    const bsPercent = document.getElementById('bsPercent');
    const gameDataContainer = document.getElementById('gameDataContainer');
    const windowsBox = document.getElementById('windowsBox');

    let lastIssueNumber = null;
    let lastShownIssue = null;

    function getFullName(type, value) {
      if (type === 'bs') return value === 'BIG' ? 'Big' : value === 'SMALL' ? 'Small' : '--';
      if (type === 'color') return value === 'red' ? 'Red' : value === 'green' ? 'Green' : '--';
      return '--';
    }

    function analyze(dataList) {
      const numbers = dataList.map(d => Number(d.number));
      const freq = {}, colorCount = { red: 0, green: 0 };
      let big = 0, small = 0;

      numbers.forEach(n => {
        freq[n] = (freq[n] || 0) + 1;
        n <= 4 ? small++ : big++;
      });

      dataList.forEach(d => {
        d.colour.toLowerCase().split(',').forEach(c => {
          if (c === 'red' || c === 'green') colorCount[c]++;
        });
      });

      const sorted = Object.entries(freq).sort((a,b) => b[1]-a[1]);
      const top3 = sorted.slice(0, 3).map(e => e[0]);
      const diff = Math.abs(big - small);
      let confidenceBS = diff >= 3 ? 90 : diff === 2 ? 82 : diff === 1 ? 75 : 70;
      if (sorted[0][1] >= 3) confidenceBS += 5;
      if (confidenceBS > 95) confidenceBS = 95;

      const colorDiff = Math.abs(colorCount.red - colorCount.green);
      let confidenceColor = colorDiff >= 6 ? 95 : colorDiff >= 4 ? 88 : colorDiff >= 2 ? 80 : 50;

      let bigSmallPattern = big > small ? 'BIG' : small > big ? 'SMALL' : 'SKIP';
      let topColor = colorCount.red > colorCount.green ? 'red' : colorCount.green > colorCount.red ? 'green' : 'skip';

      return { bigSmallPattern, topColor, top3Numbers: top3, confidenceBS, confidenceColor };
    }

    function renderInfo(analysis) {
      bigSmallEl.textContent = getFullName('bs', analysis.bigSmallPattern);
      bsPercent.textContent = `(${analysis.confidenceBS}%)`;
      redGreenEl.textContent = `${getFullName('color', analysis.topColor)} (${analysis.confidenceColor}%)`;
      redGreenEl.className = analysis.topColor === 'red' ? 'text-red-500' : 'text-green-400';
      numbersBox.innerHTML = '';
      (analysis.top3Numbers || []).forEach(num => {
        const span = document.createElement('span');
        span.textContent = num;
        span.className = 'inline-block bg-blue-600 px-2 py-1 rounded-lg text-lg font-extrabold mr-2';
        numbersBox.appendChild(span);
      });
    }

    function appendToWindows(issue, number, color, pred) {
      if (issue === lastShownIssue) return;
      lastShownIssue = issue;
      const bs = number <= 4 ? 'SMALL' : 'BIG';
      const c = color;
      const matchBS = pred.bigSmallPattern === bs;
      const matchColor = pred.topColor === c;
      const line = document.createElement('div');
      const short = issue.toString().slice(-4);
      line.innerHTML = `${short} | ${number} |${pred.bigSmallPattern}| 
        <span class="${matchBS ? 'win' : 'loss'}">${matchBS ? '✅' : '❌'}</span>
        |${pred.topColor}| <span class="${matchColor ? 'win' : 'loss'}">${matchColor ? '✅' : '❌'}</span>`;
      windowsBox.prepend(line);
    }

    function renderTable(list) {
      gameDataContainer.innerHTML = '';
      const table = document.createElement('table');
      table.className = 'w-full text-sm text-center bg-gray-800';
      table.innerHTML = `
        <thead class="bg-blue-600 text-black"><tr><th>Issue</th><th>Number</th><th>Colour</th></tr></thead>
        <tbody>${list.map(i => `
          <tr class="hover:bg-gray-600"><td>${i.issueNumber}</td><td>${i.number}</td><td>${i.colour}</td></tr>
        `).join('')}</tbody>`;
      gameDataContainer.appendChild(table);
    }

    async function fetchAndAnalyzeRepeatedly() {
      try {
        const res = await fetch('https://crbbb.com/api/webapi/GetNoaverageEmerdList', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json;charset=UTF-8' },
          body: JSON.stringify({
            pageSize: 10,
            pageNo: 1,
            typeId: 30,
            language: 0,
            random: "62d02162c2234c64b57aa4188c5810b2",
            signature: "9BF7A245709AA054E231D75C404C6527",
            timestamp: Math.floor(Date.now() / 1000)
          })
        });
        const data = await res.json();
        const list = data?.data?.list;
        if (!list || !list.length) return;

        const currentIssue = list[0].issueNumber;
        if (currentIssue === lastIssueNumber) return;
        lastIssueNumber = currentIssue;

        const result = analyze(list);
        renderInfo(result);
        renderTable(list);
        const latest = list[0];
        appendToWindows(latest.issueNumber, Number(latest.number), latest.colour.toLowerCase().split(',')[0], result);
      } catch (err) {
        console.error("Fetch error", err);
      }
    }

    function updateTimer() {
      const now = new Date();
      const base = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 5, 30, 0);
      if (now < base) base.setDate(base.getDate() - 1);
      const elapsed = Math.floor((now - base) / 1000);
      const remain = 30 - (elapsed % 30);
      document.getElementById("timer").innerText = `00:${String(remain).padStart(2, '0')}`;
      if (remain === 30) fetchAndAnalyzeRepeatedly();
      setTimeout(updateTimer, 1000);
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateTimer();
      fetchAndAnalyzeRepeatedly();
    });
  </script></body>
</html>
